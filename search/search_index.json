{"config":{"lang":["en","tr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Start","text":"<p>Hello everyone,</p> <p>On these web pages, I will try to explain the Wallet Framework to you without overwhelming you with code.  In the first section, I will briefly explain what the Wallet Framework does.From now on, I will refer to the Wallet Framework as \u2018WF\u2019 throughout those pages. WF is a framework designed for peer-to-peer (P2P) transactions commonly used in the financial sector and their tracking (via an admin panel). The goal is to use appropriate architecture and technologies while performing these operations. </p> <p>WF's capabilities include:</p> <ul> <li>P2P transfers</li> <li>Internal Fraud Controls</li> <li>Audit logs</li> <li>Full metric observability</li> <li>An admin panel for managing customers and transactions</li> <li>Role-based authorization</li> <li>Secret management using a secret vault</li> <li>Full dockerization</li> </ul> <p>If you'd like, I'd also like to briefly mention why I felt the need to do this: The Story</p>"},{"location":"architecture/","title":"Architecture","text":"<p>About the architecture I chose:</p> <p>Here, I will try to explain why I chose these architectures from my own perspective.</p> <p>Microservices: First, I want to start with the microservices architecture. Actually, I wasn't very sure when choosing this architecture; because even though it has been implemented for years, I still think it is an approach with too many gray areas. However, one of the most common problems I encountered in my experience was high traffic. Applications that perform financial transactions inevitably have high traffic, and scalability was critical to handle this traffic. I also researched the modular monolith structure as an alternative to microservices, and at one point, I even decided to proceed with this structure. However, independent scalability and other operational advantages prevailed, so I developed the framework using the microservices architecture.</p> <p>EDD and CQRS: These topics became a necessity at some point after the microservice architecture came into play. When working with microservices, different patterns would only complicate things. I have always enjoyed using CQRS in particular. Since its advantages are already well-known, I don't feel the need to explain them again.</p> <p>Saga pattern: The reason I use this pattern is because I encountered a wallet application in my career that was developed without using the saga pattern. Money transfers were written atomically to the database, and then a background job that constantly updated the balance was running via Hangfire. Yes, it was working; however, as the project progressed, this structure became unsustainable.</p> <p>DDD: It was a very popular approach early in my career. Even back then, I constantly heard people say, \u201cDDD can't be fully implemented in projects.\u201d I saw that this observation was correct as I gained experience working on projects that claimed to be DDD. Of course, it's not a rule that everyone must follow, but I experienced that when it wasn't applied properly, unit test writing also weakened to the same extent. In most projects, at most integration tests could be written (and often even those weren't written). When you wanted to write unit tests, you were only faced with private methods loaded with business logic. That's why I wanted to apply DDD as correctly as I could research it, and while writing unit tests, I realized how appropriate this choice was.</p> <p>There are other architectural decisions I could mention in the project, but I think that would go into too much detail. Maybe I'll add to it later; for now, I'll leave it here.</p> <p>Finally, I want to discuss why I chose certain packages: Packages</p>"},{"location":"packages/","title":"Packages & Tech","text":"<p>Why did I choose this package?</p> <p>In this section, I want to explain why I chose this particular package. Also, since this part of the framework is the most open to debate, feel free to express your opinion.</p> <p>MassTransit: It was recently announced that it would be switching to a paid license. For this reason, I resisted using it for a while. However, it didn't make sense to ignore a product that has proven itself in the industry for so long just for this reason. I had worked on a finance project that used its biggest competitor, NServiceBus. I don't know if it was because of NServiceBus, but the structure seemed quite complex to me; I struggled for a long time to understand what was doing what. MassTransit also directly helped solve a problem I encountered in the project. Passing the identity of the user performing the operation to lower layers for audit logs had become a serious challenge. The MassTransit middleware was already ready to solve this problem.</p> <p>YARP: I chose YARP for the gateway project in the microservice architecture. It was extremely practical to use. I know I wasn't aware of all of YARP's capabilities and didn't use all of them; I only focused on what I needed. I had previously used Ocelot as a gateway in a project, but it seemed quite complex. That's why I gave YARP a chance, and I was satisfied with the result.</p> <p>Keycloak: The lack of a license fee was a significant factor. It also performs quite well in distributed architectures. However, if I were to start the project again, I probably wouldn't choose it; because I couldn't find a reliable NuGet package for API usage and had to write all the processes myself. This was both time-consuming and created unnecessary complexity.</p> <p>As for the other products I used, since most of you have likely encountered them at least once, I won't go into further detail.</p> <p>Now, if you'd like, I can discuss the problems I encountered: Challenges</p>"},{"location":"problems/","title":"Challenges","text":"<p>What problems did I encounter?</p> <p>The DRY thing: The developer's greatest ally becomes their greatest enemy when it comes to microservices. As a software principle, \u201cdon't repeat yourself\u201d aims to consolidate code we'll reuse repeatedly and eliminate code redundancy, which is always very useful. I developed the framework based on this principle, and ended up with the following projects:</p> <p>WF.Shared.Application WF.Shared.Infrastructure WF.Shared.Domain!!! (yes, domain)</p> <p>In the end, I created a parallel monolithic application by placing all the shared code in one place. When I realized there was a problem somewhere, I removed all the shared projects and rewrote every piece of code under its own service. It was indeed a huge workload, but that's why AI tools exist, right?</p> <p>What to include in the saga: This was one of the most challenging decisions. Some opinions suggest that the saga should contain as little information as possible, with services fetching the necessary data themselves, while others advocate for a \u201cfat saga\u201d structure; that is, the saga should carry everything (provided there are no security vulnerabilities), sparing services from extra processing inside. I went back and forth between these two options, but ultimately decided on the fat saga approach. If you look at the code, when a transaction starts, I provide the wallet numbers, etc., within the saga. This way, I aimed to reduce the number of queries made by the fraud service, for example.</p> <p>UserId transfer issue in audit logs: UserId is not a value that you can access from everywhere in the project or transfer to every layer. That's why I had to struggle quite a bit when transferring this information to the audit logs. Of course, it wasn't transferred via the HTTP context as standard. Here, I decided to transfer it via MassTransit headers. If you do this and are transferring sensitive data, don't forget to encrypt it.</p> <p>Introducing Keycloak roles: When trying to implement RBAC in Keycloak, you need to write a converter to introduce the same roles on the .NET side, and most of this part is written manually. Also, since this is required in every service, this code must not be forgotten. It caused me a significant amount of time loss, especially in the final stages of the project. Therefore, as I mentioned in the packages section, I might consider using another identity product that supports NuGet packages.</p> <p>Thank you for taking the time to read this far. Please feel free to use the code in the project or contribute to it. See you again soon.</p>"},{"location":"story/","title":"The Story","text":"<p>Why did I want to build such a framework?</p> <p>I have been working as a software developer in the finance sector for a long time. This has given me the opportunity to develop code and gain experience in many fintech projects. In doing so, I realized that common problems were always being solved using different methods. The biggest reason for this problem was time constraints. Therefore, throughout my career, I tried to solve these problems as best I could under a single framework. At the same time, this would also help me in future tasks.</p> <p>My goal was not to create a product with every feature completed. I just wanted to prepare a guide that a software developer who is confused about such a structure or looking for alternatives could refer to. While developing this framework, I made sure to include at least one example of the most commonly used features. This way, I aimed to make it easy to add any other missing features.</p> <p>I am still developing this framework, so please feel free to contribute. You can also use the code as you see fit.</p> <p>If you like, let's talk a little about the architecture. Architecture</p>"},{"location":"tr/","title":"Start","text":"<p>Merhaba, bu web sayfalar\u0131nda sizlere Wallet Framework'\u00fc kodlarla s\u0131kmadan anltmaya \u00e7al\u0131\u015faca\u011f\u0131m. \u0130lk b\u00f6l\u00fcmde k\u0131saca sizlere Wallet Framework'\u00fcn ne yapt\u0131\u011f\u0131n\u0131 anlataca\u011f\u0131m. Bundan sonra d\u00f6k\u00fcman genelinde Wallet Framework\u2019ten \u201cWF\u201d olarak bahsedece\u011fim. WF, finans sekt\u00f6r\u00fcnde s\u0131k\u00e7a kullan\u0131lan p2p i\u015flemlerini ve bu i\u015flemlerin takibini (admin paneli ile) ama\u00e7layan bir framework\u2019t\u00fcr. Bu i\u015flemleri yaparken uygun mimarinin ve teknolojilerin kullan\u0131lmas\u0131 hedeflenmi\u015ftir.</p> <p>WF\u2019nin yetenekleri aras\u0131nda \u015funlar bulunmaktad\u0131r:</p> <ul> <li>P2P transfer</li> <li>Internal fraud kontrolleri</li> <li>Audit loglar\u0131</li> <li>Full metric observability</li> <li>M\u00fc\u015fterilerin ve transaction\u2019lar\u0131n y\u00f6netilebilece\u011fi admin paneli</li> <li>Rol bazl\u0131 yetkilendirme</li> <li>Secret vault kullan\u0131larak secret y\u00f6netimi</li> <li>Full dockerize</li> </ul> <p>\u0130sterseniz \u015fimdi de bunu neden yapma gere\u011fi duydu\u011fumdan biraz bahsetmek isterim:  The Story</p>"},{"location":"tr/architecture/","title":"Architecture","text":"<p>Se\u00e7ti\u011fim mimari hakk\u0131nda:</p> <p>Burada se\u00e7ti\u011fim mimarileri neden tercih etti\u011fimi kendi bak\u0131\u015f a\u00e7\u0131mdan a\u00e7\u0131klamaya \u00e7al\u0131\u015faca\u011f\u0131m.</p> <p>Mikroservisler: \u0130lk olarak mikroservis mimarisinden ba\u015flamak istiyorum. Asl\u0131nda bu mimariyi se\u00e7erken \u00e7ok emin de\u011fildim; \u00e7\u00fcnk\u00fc y\u0131llard\u0131r uygulan\u0131yor olsa da h\u00e2l\u00e2 gri alan\u0131 fazla olan bir yakla\u015f\u0131m oldu\u011funu d\u00fc\u015f\u00fcn\u00fcyorum. Ancak deneyimlerimde en s\u0131k kar\u015f\u0131la\u015ft\u0131\u011f\u0131m sorunlardan biri y\u00fcksek trafikti. Finansal i\u015flemlerin y\u00fcr\u00fct\u00fcld\u00fc\u011f\u00fc uygulamalarda trafik kesin olarak y\u00fcksek oluyor ve bu trafi\u011fi kar\u015f\u0131lamak i\u00e7in \u00f6l\u00e7eklenebilirlik kritik \u00f6nem ta\u015f\u0131yordu. Mikroservisi se\u00e7memek i\u00e7in mod\u00fcler monolith yap\u0131s\u0131n\u0131 da ara\u015ft\u0131rd\u0131m, hatta bir ara bu yap\u0131yla ilerlemeye karar vermi\u015ftim. Ancak ba\u011f\u0131ms\u0131z \u00f6l\u00e7eklenebilirlik ve di\u011fer operasyonel avantajlar a\u011f\u0131r bast\u0131\u011f\u0131 i\u00e7in framework\u2019\u00fc mikroservis mimarisiyle geli\u015ftirdim.</p> <p>EDD ve CQRS: Bu konular mikroservis mimarisi devreye girdikten sonra bir noktada zorunluluk gibi kar\u015f\u0131ma \u00e7\u0131kt\u0131. Mikroservislerle \u00e7al\u0131\u015f\u0131rken farkl\u0131 pattern\u2019ler i\u015fleri yaln\u0131zca karma\u015f\u0131kla\u015ft\u0131racakt\u0131. \u00d6zellikle CQRS kullanmaktan her zaman keyif alm\u0131\u015f\u0131md\u0131r. Avantajlar\u0131 zaten bilinen noktalar oldu\u011fu i\u00e7in tekrar a\u00e7\u0131klama gere\u011fi duymuyorum.</p> <p>Saga pattern: Bu pattern\u2019i kullanmam\u0131n sebebi kariyerimde denk geldi\u011fim, saga pattern kullan\u0131lmadan geli\u015ftirilmi\u015f bir c\u00fczdan uygulamas\u0131 oldu. Para transferleri atomik olarak veritaban\u0131na yaz\u0131l\u0131yor, ard\u0131ndan Hangfire arac\u0131l\u0131\u011f\u0131yla s\u00fcrekli bakiye g\u00fcncelleyen bir background job \u00e7al\u0131\u015f\u0131yordu. Evet, \u00e7al\u0131\u015f\u0131yordu; ancak proje ilerledik\u00e7e bu yap\u0131n\u0131n ne kadar fazla a\u00e7\u0131\u011f\u0131 oldu\u011funu g\u00f6rd\u00fcm. G\u00fcn\u00fcn sonunda sistem s\u00fcrekli artan teknik borca d\u00f6n\u00fcyordu. Saga pattern\u2019in zorlu\u011fu ise yeni yaz\u0131l\u0131mc\u0131lar i\u00e7in ak\u0131\u015f\u0131n kavranmas\u0131n\u0131n kolay olmamas\u0131. Yap\u0131y\u0131 ilk kurdu\u011fum d\u00f6nemlerde hangi event\u2019ten sonra ne olaca\u011f\u0131n\u0131, hot path\u2019in nas\u0131l i\u015fleyece\u011fini anlamaya \u00e7al\u0131\u015f\u0131rken zorland\u0131m. Fakat buna ra\u011fmen MassTransit ve saga pattern birle\u015fti\u011finde s\u00fcre\u00e7lerin ne kadar kolay \u00e7\u00f6z\u00fcld\u00fc\u011f\u00fcn\u00fc fark ettim. Bu ikili, karma\u015f\u0131k ak\u0131\u015flar\u0131 \u00fcstlenme konusunda olduk\u00e7a ba\u015far\u0131l\u0131.</p> <p>DDD: Kariyerimin ba\u015flar\u0131nda olduk\u00e7a pop\u00fcler olan bir yakla\u015f\u0131md\u0131. O zamanlar bile s\u00fcrekli \u201cDDD projelerde tam uygulanam\u0131yor\u201d denildi\u011fini duyuyordum. Bu tespitin do\u011fru oldu\u011funu ddd oldu\u011funu iddia eden projelerde \u00e7al\u0131\u015fma f\u0131rsat\u0131 bulduk\u00e7a g\u00f6rd\u00fcm. Herkesin uygulamas\u0131 gereken bir kural de\u011fil elbette, ancak d\u00fczg\u00fcn uygulanmad\u0131\u011f\u0131nda uygulanmad\u0131\u011f\u0131nda unit test yaz\u0131m\u0131n\u0131n da ayn\u0131 oranda zay\u0131flad\u0131\u011f\u0131n\u0131 deneyimledim. \u00c7o\u011fu projede en fazla entegrasyon testleri yaz\u0131labiliyordu (ki \u00e7o\u011fu zaman onlar bile yaz\u0131lm\u0131yordu). Unit test yazmak istedi\u011finizde ise kar\u015f\u0131n\u0131za yaln\u0131zca i\u015f mant\u0131\u011f\u0131 y\u00fckl\u00fc private metotlar \u00e7\u0131k\u0131yordu. Bu nedenle DDD\u2019yi ara\u015ft\u0131rabildi\u011fim kadar do\u011fru bi\u00e7imde uygulamak istedim ve unit test yazarken bunun ne kadar yerinde bir tercih oldu\u011funu anlad\u0131m.</p> <p>Projede bahsedebilece\u011fim ba\u015fka mimari kararlar da var ancak bunlar\u0131n daha fazla detaya girece\u011fini d\u00fc\u015f\u00fcn\u00fcyorum. Belki ileride eklemelerde bulunurum; \u015fimdilik burada b\u0131rak\u0131yorum.</p> <p>Son olarak hangi paketleri neden tercih etti\u011fimden bahsetmek istiyorum: Packages</p>"},{"location":"tr/packages/","title":"Packages & Tech","text":"<p>Hangi paketi neden kulland\u0131m?</p> <p>Bu b\u00f6l\u00fcmde hangi paketi neden tercih etti\u011fimi a\u00e7\u0131klamak istiyorum. Ayn\u0131 zamanda bu k\u0131s\u0131m framework\u2019\u00fcn en tart\u0131\u015fmaya a\u00e7\u0131k b\u00f6l\u00fcm\u00fc oldu\u011fu i\u00e7in g\u00f6r\u00fc\u015f belirtmekten \u00e7ekinmeyin.</p> <p>MassTransit: Yak\u0131n zamanda \u00fccretli lisansa ge\u00e7ilece\u011fi duyuruldu. Bu nedenle kullanmamak i\u00e7in bir s\u00fcre direndim. Ancak sekt\u00f6rde uzun s\u00fcredir kendini kan\u0131tlam\u0131\u015f bir \u00fcr\u00fcn\u00fc yaln\u0131zca bu sebeple g\u00f6z ard\u0131 etmek mant\u0131kl\u0131 de\u011fildi. En b\u00fcy\u00fck rakibi olan NServiceBus\u2019\u0131n kullan\u0131ld\u0131\u011f\u0131 bir finans projesinde g\u00f6rev alm\u0131\u015ft\u0131m. NServiceBus\u2019tan m\u0131 kaynakl\u0131yd\u0131 bilmiyorum ama yap\u0131 bana olduk\u00e7a karma\u015f\u0131k gelmi\u015fti; neyin ne yapt\u0131\u011f\u0131n\u0131 anlamak i\u00e7in uzun s\u00fcre u\u011fra\u015fm\u0131\u015ft\u0131m. MassTransit projede kar\u015f\u0131la\u015ft\u0131\u011f\u0131m bir sorunu \u00e7\u00f6zmekte de do\u011frudan yard\u0131mc\u0131 oldu. Audit loglar\u0131 i\u00e7in i\u015flemi yapan kullan\u0131c\u0131n\u0131n kimli\u011fini alt katmanlara ta\u015f\u0131mak ciddi bir zorluk haline gelmi\u015fti. MassTransit middleware\u2019i bu problemi \u00e7\u00f6zmek i\u00e7in zaten haz\u0131r bekliyordu.</p> <p>YARP: Mikroservis mimarisinde gateway projesi i\u00e7in YARP\u2019\u0131 tercih ettim. Kullan\u0131m\u0131 son derece pratikti. YARP\u2019\u0131n t\u00fcm yeteneklerinin fark\u0131nda olmad\u0131\u011f\u0131m\u0131 ve tamam\u0131n\u0131 kullanmad\u0131\u011f\u0131m\u0131 biliyorum; ihtiyac\u0131m olan kadar\u0131yla ilgilendim. Daha \u00f6nce bir projede gateway olarak Ocelot kullanm\u0131\u015ft\u0131m, ancak olduk\u00e7a karma\u015f\u0131k gelmi\u015fti. Bu nedenle YARP\u2019a \u015fans verdim ve sonu\u00e7tan memnun kald\u0131m.</p> <p>Keycloak: Lisans \u00fccreti olmamas\u0131 \u00f6nemli bir etken oldu. Ayn\u0131 zamanda da\u011f\u0131t\u0131k mimarilerde performans\u0131 olduk\u00e7a iyi. Ancak projeye yeniden ba\u015flasam b\u00fcy\u00fck ihtimalle tercih etmezdim; \u00e7\u00fcnk\u00fc API kullan\u0131m\u0131 i\u00e7in g\u00fcvenilir bir NuGet paketi bulamad\u0131m ve t\u00fcm i\u015flemleri kendim yazmak zorunda kald\u0131m. Bu hem zaman kayb\u0131 yaratt\u0131 hem de gereksiz karma\u015f\u0131kl\u0131k olu\u015fturdu.</p> <p>Bunlar d\u0131\u015f\u0131nda kulland\u0131\u011f\u0131m di\u011fer \u00fcr\u00fcnler \u00e7o\u011funuzun en az bir kere kar\u015f\u0131la\u015ft\u0131\u011f\u0131 yap\u0131lar oldu\u011fundan daha fazla detaya girmiyorum.</p> <p>\u015eimdi isterseniz hangi problemlerle kar\u015f\u0131la\u015ft\u0131\u011f\u0131mdan bahsedeyim: Challenges</p>"},{"location":"tr/problems/","title":"Challenges","text":"<p>Hangi problemlerle kar\u015f\u0131la\u015ft\u0131m?</p> <p>DRY konusu: Yaz\u0131l\u0131mc\u0131n\u0131n en b\u00fcy\u00fck yard\u0131mc\u0131s\u0131, konu mikroservis olunca en b\u00fcy\u00fck d\u00fc\u015fmana d\u00f6n\u00fc\u015f\u00fcyor. Bir yaz\u0131l\u0131m ilkesi olarak \"don\u2019t repeat yourself\"in amac\u0131 tekrar tekrar kullanaca\u011f\u0131m\u0131z kodlar\u0131 ortakla\u015ft\u0131r\u0131p kod fazlal\u0131\u011f\u0131ndan kurtulmakt\u0131r ki her zaman da \u00e7ok i\u015fe yarar. Ben de bu d\u00fcsturla framework\u2019\u00fc geli\u015ftirdim ve elimde \u015fu projeler oldu:</p> <p>WF.Shared.Application WF.Shared.Infrastructure WF.Shared.Domain!!! (evet domain)</p> <p>G\u00fcn\u00fcn sonunda ortak olan kodlar\u0131 bir yere alarak paralel bir monolith uygulama kurdum. Bir yerde sorun oldu\u011funu anlad\u0131\u011f\u0131mda b\u00fct\u00fcn shared projeleri kald\u0131rd\u0131m ve her kodu kendi servisi alt\u0131nda tekrar tekrar yazd\u0131m. Ger\u00e7ekten de b\u00fcy\u00fck bir i\u015f y\u00fck\u00fcyd\u00fc ama AI tool\u2019lar neden var de\u011fil mi?</p> <p>Saga\u2019da neler ta\u015f\u0131naca\u011f\u0131 konusu: En \u00e7ok ikilemde kald\u0131\u011f\u0131m konulardan birisi oldu bu. Kimi g\u00f6r\u00fc\u015fler saga\u2019n\u0131n olabildi\u011fince az bilgi i\u00e7ermesini ve servislerin gerekli bilgileri kendi almas\u0131n\u0131 \u00f6nerirken, kimi g\u00f6r\u00fc\u015fler \u201cfat saga\u201d yap\u0131s\u0131n\u0131 savunuyor; yani saga ne varsa ta\u015f\u0131s\u0131n (g\u00fcvenlik a\u00e7\u0131\u011f\u0131 olmayan), servisler i\u00e7eride ekstra i\u015fle u\u011fra\u015fmas\u0131n. Ben de bu iki tercih aras\u0131nda gidip geldim ama son olarak karar\u0131m\u0131 fat saga y\u00f6n\u00fcnde verdim. Kodu incelerseniz bir transaction ba\u015flad\u0131\u011f\u0131nda wallet number\u2019lar\u0131 vs. saga\u2019n\u0131n i\u00e7inde veriyorum. B\u00f6ylece \u00f6rne\u011fin fraud servisinin daha az sorgu yapmas\u0131n\u0131 hedefledim.</p> <p>Audit log\u2019lara userId ta\u015f\u0131ma sorunu: UserId projede her yerden eri\u015febildi\u011finiz veya her katmana ta\u015f\u0131yabildi\u011finiz bir de\u011fer de\u011fil. Bu y\u00fczden audit loglar\u0131na bu bilgiyi ta\u015f\u0131rken baya u\u011fra\u015fmak zorunda kald\u0131m. Standart olarak HTTP context \u00fczerinden ta\u015f\u0131nmad\u0131 tabii ki. Burada da karar\u0131m MassTransit header\u2019lar\u0131 arac\u0131l\u0131\u011f\u0131yla ta\u015f\u0131maktan yana oldu. E\u011fer bunu yap\u0131yorsan\u0131z ve hassas data ta\u015f\u0131yacaksan\u0131z encrypt etmeyi unutmay\u0131n.</p> <p>Keycloak rollerinin tan\u0131t\u0131lmas\u0131: Keycloak\u2019ta RBAC yapmaya \u00e7al\u0131\u015f\u0131rken ayn\u0131 rollerin .NET taraf\u0131nda tan\u0131t\u0131lmas\u0131 i\u00e7in bir d\u00f6n\u00fc\u015ft\u00fcr\u00fcc\u00fc yazman\u0131z gerekiyor ve bu k\u0131sm\u0131n b\u00fcy\u00fck bir b\u00f6l\u00fcm\u00fc manuel olarak yaz\u0131l\u0131yor. Ayn\u0131 zamanda her serviste bu gerekti\u011fi i\u00e7in bu kodun unutulmamas\u0131 gerekiyor. \u00d6zellikle projenin son safhalar\u0131nda bana b\u00fcy\u00fck zaman kayb\u0131 ya\u015fatt\u0131. O y\u00fczden paketler k\u0131sm\u0131nda belirtti\u011fim gibi NuGet paketi deste\u011fi olan ba\u015fka bir identity \u00fcr\u00fcn\u00fc kullanmay\u0131 d\u00fc\u015f\u00fcnebilirim.</p> <p>Buraya kadar vakit ay\u0131r\u0131p okudu\u011funuz i\u00e7in te\u015fekk\u00fcr ederim. L\u00fctfen projedeki kodlar\u0131 kullanmaktan veya projeye katk\u0131 yapmaktan \u00e7ekinmeyin. Tekrar g\u00f6r\u00fc\u015fmek \u00fczere.</p>"},{"location":"tr/story/","title":"The Story","text":"<p>Neden b\u00f6yle bir framework kurmak istedim?</p> <p>Uzun zamand\u0131r finans sekt\u00f6r\u00fcnde yaz\u0131l\u0131mc\u0131 olarak g\u00f6rev al\u0131yorum. Bu sayede, bir\u00e7ok fintech projesinde kod geli\u015ftirip deneyimleme f\u0131rsat\u0131 buldum. B\u00f6ylece asl\u0131nda ortak olan sorunlar\u0131n hep farkl\u0131 y\u00f6ntemlerle \u00e7\u00f6z\u00fclmeye \u00e7al\u0131\u015f\u0131ld\u0131\u011f\u0131n\u0131 fark ettim. Bu sorunun en b\u00fcy\u00fck sebebi de zaman k\u0131s\u0131t\u0131 oluyordu. Bu y\u00fczden kariyerim boyunca kar\u015f\u0131ma \u00e7\u0131kan bu sorunlar\u0131 tek bir framework alt\u0131nda elimden geldi\u011fince \u00e7\u00f6zmeye \u00e7al\u0131\u015ft\u0131m. Ayn\u0131 zamanda bu benim i\u00e7in de ileride alaca\u011f\u0131m g\u00f6revlerde yard\u0131mc\u0131 olacakt\u0131.</p> <p>Amac\u0131m ortaya her \u00f6zelli\u011fi tamamlanm\u0131\u015f bir \u00fcr\u00fcn koymak de\u011fildi. Sadece b\u00f6yle bir yap\u0131 konusunda kafas\u0131 kar\u0131\u015fan veya alternatif arayan bir yaz\u0131l\u0131mc\u0131n\u0131n ba\u015fvurabilece\u011fi bir rehber haz\u0131rlamakt\u0131. Bu framework\u2019\u00fc geli\u015ftirirken en s\u0131k kullan\u0131lan \u00f6zelliklerin en az\u0131ndan birer \u00f6rne\u011fine yer vermeye dikkat ettim. B\u00f6ylece eksik olan di\u011fer \u00f6zelliklerin rahat\u00e7a eklenebilir olmas\u0131n\u0131 ama\u00e7lad\u0131m.</p> <p>Hala bu framework\u2019\u00fc geli\u015ftirmeye devam ediyorum, bu y\u00fczden katk\u0131 sa\u011flamaktan l\u00fctfen \u00e7ekinmeyin. Kodlar\u0131 da istedi\u011finiz gibi kullanabilirsiniz.</p> <p>\u0130sterseniz mimari k\u0131sm\u0131ndan biraz konu\u015fal\u0131m. Architecture</p>"},{"location":"","title":"Start","text":"<p>Hello everyone,</p> <p>On these web pages, I will try to explain the Wallet Framework to you without overwhelming you with code.  In the first section, I will briefly explain what the Wallet Framework does.From now on, I will refer to the Wallet Framework as \u2018WF\u2019 throughout those pages. WF is a framework designed for peer-to-peer (P2P) transactions commonly used in the financial sector and their tracking (via an admin panel). The goal is to use appropriate architecture and technologies while performing these operations. </p> <p>WF's capabilities include:</p> <ul> <li>P2P transfers</li> <li>Internal Fraud Controls</li> <li>Audit logs</li> <li>Full metric observability</li> <li>An admin panel for managing customers and transactions</li> <li>Role-based authorization</li> <li>Secret management using a secret vault</li> <li>Full dockerization</li> </ul> <p>If you'd like, I'd also like to briefly mention why I felt the need to do this: The Story</p>"},{"location":"architecture/","title":"Architecture","text":"<p>About the architecture I chose:</p> <p>Here, I will try to explain why I chose these architectures from my own perspective.</p> <p>Microservices: First, I want to start with the microservices architecture. Actually, I wasn't very sure when choosing this architecture; because even though it has been implemented for years, I still think it is an approach with too many gray areas. However, one of the most common problems I encountered in my experience was high traffic. Applications that perform financial transactions inevitably have high traffic, and scalability was critical to handle this traffic. I also researched the modular monolith structure as an alternative to microservices, and at one point, I even decided to proceed with this structure. However, independent scalability and other operational advantages prevailed, so I developed the framework using the microservices architecture.</p> <p>EDD and CQRS: These topics became a necessity at some point after the microservice architecture came into play. When working with microservices, different patterns would only complicate things. I have always enjoyed using CQRS in particular. Since its advantages are already well-known, I don't feel the need to explain them again.</p> <p>Saga pattern: The reason I use this pattern is because I encountered a wallet application in my career that was developed without using the saga pattern. Money transfers were written atomically to the database, and then a background job that constantly updated the balance was running via Hangfire. Yes, it was working; however, as the project progressed, this structure became unsustainable.</p> <p>DDD: It was a very popular approach early in my career. Even back then, I constantly heard people say, \u201cDDD can't be fully implemented in projects.\u201d I saw that this observation was correct as I gained experience working on projects that claimed to be DDD. Of course, it's not a rule that everyone must follow, but I experienced that when it wasn't applied properly, unit test writing also weakened to the same extent. In most projects, at most integration tests could be written (and often even those weren't written). When you wanted to write unit tests, you were only faced with private methods loaded with business logic. That's why I wanted to apply DDD as correctly as I could research it, and while writing unit tests, I realized how appropriate this choice was.</p> <p>There are other architectural decisions I could mention in the project, but I think that would go into too much detail. Maybe I'll add to it later; for now, I'll leave it here.</p> <p>Finally, I want to discuss why I chose certain packages: Packages</p>"},{"location":"packages/","title":"Packages & Tech","text":"<p>Why did I choose this package?</p> <p>In this section, I want to explain why I chose this particular package. Also, since this part of the framework is the most open to debate, feel free to express your opinion.</p> <p>MassTransit: It was recently announced that it would be switching to a paid license. For this reason, I resisted using it for a while. However, it didn't make sense to ignore a product that has proven itself in the industry for so long just for this reason. I had worked on a finance project that used its biggest competitor, NServiceBus. I don't know if it was because of NServiceBus, but the structure seemed quite complex to me; I struggled for a long time to understand what was doing what. MassTransit also directly helped solve a problem I encountered in the project. Passing the identity of the user performing the operation to lower layers for audit logs had become a serious challenge. The MassTransit middleware was already ready to solve this problem.</p> <p>YARP: I chose YARP for the gateway project in the microservice architecture. It was extremely practical to use. I know I wasn't aware of all of YARP's capabilities and didn't use all of them; I only focused on what I needed. I had previously used Ocelot as a gateway in a project, but it seemed quite complex. That's why I gave YARP a chance, and I was satisfied with the result.</p> <p>Keycloak: The lack of a license fee was a significant factor. It also performs quite well in distributed architectures. However, if I were to start the project again, I probably wouldn't choose it; because I couldn't find a reliable NuGet package for API usage and had to write all the processes myself. This was both time-consuming and created unnecessary complexity.</p> <p>As for the other products I used, since most of you have likely encountered them at least once, I won't go into further detail.</p> <p>Now, if you'd like, I can discuss the problems I encountered: Challenges</p>"},{"location":"problems/","title":"Challenges","text":"<p>What problems did I encounter?</p> <p>The DRY thing: The developer's greatest ally becomes their greatest enemy when it comes to microservices. As a software principle, \u201cdon't repeat yourself\u201d aims to consolidate code we'll reuse repeatedly and eliminate code redundancy, which is always very useful. I developed the framework based on this principle, and ended up with the following projects:</p> <p>WF.Shared.Application WF.Shared.Infrastructure WF.Shared.Domain!!! (yes, domain)</p> <p>In the end, I created a parallel monolithic application by placing all the shared code in one place. When I realized there was a problem somewhere, I removed all the shared projects and rewrote every piece of code under its own service. It was indeed a huge workload, but that's why AI tools exist, right?</p> <p>What to include in the saga: This was one of the most challenging decisions. Some opinions suggest that the saga should contain as little information as possible, with services fetching the necessary data themselves, while others advocate for a \u201cfat saga\u201d structure; that is, the saga should carry everything (provided there are no security vulnerabilities), sparing services from extra processing inside. I went back and forth between these two options, but ultimately decided on the fat saga approach. If you look at the code, when a transaction starts, I provide the wallet numbers, etc., within the saga. This way, I aimed to reduce the number of queries made by the fraud service, for example.</p> <p>UserId transfer issue in audit logs: UserId is not a value that you can access from everywhere in the project or transfer to every layer. That's why I had to struggle quite a bit when transferring this information to the audit logs. Of course, it wasn't transferred via the HTTP context as standard. Here, I decided to transfer it via MassTransit headers. If you do this and are transferring sensitive data, don't forget to encrypt it.</p> <p>Introducing Keycloak roles: When trying to implement RBAC in Keycloak, you need to write a converter to introduce the same roles on the .NET side, and most of this part is written manually. Also, since this is required in every service, this code must not be forgotten. It caused me a significant amount of time loss, especially in the final stages of the project. Therefore, as I mentioned in the packages section, I might consider using another identity product that supports NuGet packages.</p> <p>Thank you for taking the time to read this far. Please feel free to use the code in the project or contribute to it. See you again soon.</p>"},{"location":"story/","title":"The Story","text":"<p>Why did I want to build such a framework?</p> <p>I have been working as a software developer in the finance sector for a long time. This has given me the opportunity to develop code and gain experience in many fintech projects. In doing so, I realized that common problems were always being solved using different methods. The biggest reason for this problem was time constraints. Therefore, throughout my career, I tried to solve these problems as best I could under a single framework. At the same time, this would also help me in future tasks.</p> <p>My goal was not to create a product with every feature completed. I just wanted to prepare a guide that a software developer who is confused about such a structure or looking for alternatives could refer to. While developing this framework, I made sure to include at least one example of the most commonly used features. This way, I aimed to make it easy to add any other missing features.</p> <p>I am still developing this framework, so please feel free to contribute. You can also use the code as you see fit.</p> <p>If you like, let's talk a little about the architecture. Architecture</p>"}]}